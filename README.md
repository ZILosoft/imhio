# TCG GCP Infrastructure
Этот репозиторий позволяет развернуть инфраструкуру для приложения TCG в облаке Google Cloud Platform
# GCP
Для начала создаем проект в google cloud 

```bash
gcloud init 
gcloud projects create imhio-infra --set-as-default
gcloud auth application-default login
```


# Terraform
После успешной авторизации можно изменить переменные в файле terraform/variables.tf и после этого применить изменения (не забываем указать разрешенный ip для подключения по ssh)
```bash
cd terraform
terraform init
terraform apply
```
# Результат

- 2 x инстанса с доступом из публичных сетей 
- OS Centos 7
- Оба инстанса также подключены к одной частной сети для 
организации безопасного обменаданными между приложением 
и БД 
- К истансу  instance2 подключен дополнительный внешний 
volume  для хранения данных 
- По-умолчанию все порты закрыты для внешнего интерфейсаssh доступ ограничен по IP 
- Из публичных сетей разрешен доступ только для первого инстанса к порту 8084  

# Ansible
после разворачивания инфраструктуры в GCP создасттся файл
 /ansible/inventory в котором уже будут прописаны 
 необходимые настройки, так  же в папке /secrets будут 
 находится приватный и публичный ключ для авторизации 
 на созданых машинах.
 
 так же на машинах будет создан swap файл размером 1535 (можно переопределить  ansible/roles/swap/defaults/main.yml
) или пропустить добавив --skip-tags="swap"
 
 нужнно указать удобный для вас логин\пароль и название базы данных в ansible/vars.yml
 и запустить команду
 
 
```bash
cd ../ansible
ansible-playbook main.yml -i inventory
```
# Результат
- instance1 на котором развернуто приложение 
- instance2 на котором развернута Mysql

